---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { formatDate } from "../../utils/date";

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");
  return blogEntries.map((entry: CollectionEntry<"blog">) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

// Define the type for entry
type Props = {
  entry: CollectionEntry<"blog">;
};

const { entry } = Astro.props as Props;
const { Content } = await entry.render();
---

<Layout title={entry.data.title} description={entry.data.description}>
  <div class="container mx-auto px-4 py-8">
    <article class="max-w-3xl mx-auto">
      <header class="mb-10">
        <div class="text-gray-500 dark:text-gray-400 mb-2">
          {formatDate(entry.data.pubDate)}
          {
            entry.data.updatedDate && (
              <span class="ml-2">
                (Updated: {formatDate(entry.data.updatedDate)})
              </span>
            )
          }
        </div>
        <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">
          {entry.data.title}
        </h1>
        {
          entry.data.heroImage && (
            <img
              src={entry.data.heroImage}
              alt={entry.data.title}
              class="w-full h-auto rounded-lg mb-6"
            />
          )
        }
        <p class="text-xl text-gray-600 dark:text-gray-300">
          {entry.data.description}
        </p>

        {
          entry.data.tags && entry.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-2 mt-4">
              {entry.data.tags.map((tag: string) => (
                <span class="bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 px-3 py-1 rounded-full text-sm">
                  #{tag}
                </span>
              ))}
            </div>
          )
        }
      </header>

      <div class="prose prose-lg max-w-none dark:prose-invert">
        <Content />
      </div>
    </article>
  </div>
</Layout>
