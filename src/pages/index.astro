---
// src/pages/index.astro
import Layout from "../layouts/Layout.astro";
import { formatDate } from "../utils/date";
import { getCollection, type CollectionEntry } from "astro:content";

// Get featured posts from the blog collection
const allPosts = await getCollection("blog");
const featuredPosts = allPosts
  .filter((post: CollectionEntry<"blog">) => post.data.featured)
  .sort(
    (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
      b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
  );

// Get the first featured post or the most recent post if no featured posts exist
const featuredPost =
  featuredPosts.length > 0
    ? featuredPosts[0]
    : allPosts.sort(
        (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
          b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
      )[0];

// Get featured projects from the projects collection
const allProjects = await getCollection("projects");
const featuredProjects = allProjects
  .filter((project: CollectionEntry<"projects">) => project.data.featured)
  .sort((a: CollectionEntry<"projects">, b: CollectionEntry<"projects">) =>
    b.data.year.localeCompare(a.data.year)
  );

// Get the first featured project or the most recent project if no featured projects exist
const featuredProject =
  featuredProjects.length > 0
    ? featuredProjects[0]
    : allProjects.sort(
        (a: CollectionEntry<"projects">, b: CollectionEntry<"projects">) =>
          b.data.year.localeCompare(a.data.year)
      )[0];
---

<Layout title="Francesco Esposito - Software Engineer">
  <div class="container px-4 mx-auto">
    <!-- Hero section -->
    <section class="mx-auto mb-16 max-w-4xl">
      <div class="flex flex-col gap-10 items-center md:flex-row">
        <div class="md:w-2/3">
          <h1
            class="mb-4 text-4xl font-bold text-gray-900 sm:text-5xl dark:text-white"
          >
            Hey, I'm Francesco!
          </h1>
          <p class="mb-6 text-xl text-gray-600 dark:text-gray-300">
            I'm a software engineer specializing in frontend development. This
            is my personal space where I share my knowledge and experiences.
            <span class="text-blue-500">‚ú®</span>
          </p>
          <div class="flex gap-4">
            <a
              href="/blog"
              class="px-5 py-2 font-medium text-white bg-blue-600 rounded-md transition-colors hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600"
            >
              Read the Blog
            </a>
            <a
              href="/about"
              class="px-5 py-2 font-medium text-gray-800 bg-gray-100 rounded-md transition-colors hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:hover:bg-gray-700"
            >
              About Me
            </a>
          </div>
        </div>
        <div class="md:w-1/3">
          <img
            src="https://github.com/phoinixi.png"
            alt="Francesco Esposito"
            class="object-cover mx-auto w-48 h-48 rounded-full md:w-64 md:h-64 dark:bg-gray-800"
          />
        </div>
      </div>
    </section>

    <!-- Blog section -->
    <section class="mx-auto mb-20 max-w-4xl">
      <div class="flex justify-between items-end mb-8">
        <div class="flex items-center">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Blog</h2>
          <span class="ml-2 text-lg">‚úçÔ∏è</span>
        </div>
        <a href="/blog" class="garden-link">See All</a>
      </div>

      {
        featuredPost && (
          <div>
            <article class="post-card">
              <a href={`/blog/${featuredPost.slug}`} class="block">
                <h3 class="post-title">{featuredPost.data.title}</h3>
                <div class="post-date">
                  {formatDate(featuredPost.data.pubDate)}
                </div>
                <p class="post-description">{featuredPost.data.description}</p>
                <div class="post-tags">
                  {featuredPost.data.tags.map((tag: string) => (
                    <span class="post-tag">#{tag}</span>
                  ))}
                </div>
              </a>
            </article>
          </div>
        )
      }
    </section>

    <!-- Projects section -->
    <section class="mx-auto mb-16 max-w-4xl">
      <div class="flex justify-between items-end mb-8">
        <div class="flex items-center">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
            Projects
          </h2>
          <span class="ml-2 text-lg">üíª</span>
        </div>
        <a href="/projects" class="garden-link">See All</a>
      </div>

      {
        featuredProject && (
          <div>
            <a
              href={featuredProject.data.link}
              target="_blank"
              rel="noopener noreferrer"
              class="block post-card"
            >
              <h3 class="post-title">{featuredProject.data.title}</h3>
              <p class="post-description">{featuredProject.data.description}</p>
              <div class="post-tags">
                {featuredProject.data.tags.map((tag: string) => (
                  <span class="post-tag">#{tag}</span>
                ))}
              </div>
            </a>
          </div>
        )
      }
    </section>

    <!-- Mentorship section -->
    <section class="mx-auto mb-16 max-w-4xl">
      <div class="flex justify-between items-end mb-8">
        <div class="flex items-center">
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
            Mentorship
          </h2>
          <span class="ml-2 text-lg">üë®‚Äçüè´</span>
        </div>
      </div>

      <div class="post-card">
        <div class="mb-4">
          <h3 class="post-title">Looking for guidance in your tech career?</h3>
          <p class="post-description">
            I offer one-on-one mentorship for developers looking to improve
            their frontend skills, prepare for technical interviews, or advance
            their career in software engineering.
          </p>
        </div>
        <a
          href="https://mentorcruise.com/mentor/FrancescoEsposito/"
          target="_blank"
          rel="noopener noreferrer"
          class="inline-block px-5 py-2 font-medium text-white bg-blue-600 rounded-md transition-colors hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600"
        >
          Connect on MentorCruise
        </a>
      </div>
    </section>
  </div>
</Layout>
